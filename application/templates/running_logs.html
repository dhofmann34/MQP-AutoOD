<!DOCTYPE html>
<html lang ="en">
  <body id=body_results> 
    <ul id="ul_nav">
        {% for item in nav.top %}
        <li id = "nav" class="{{ 'active' if item.is_active else '' }}">
            <a id="li_a_nav" href="{{ item.url }}">{{ item.label }}</a>
        </li>
        {% endfor %}
    </ul>
</body>
  <head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='font-awesome-4.7.0/css/font-awesome.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/d3_visualization.css') }}"> 
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/logs.css') }}"/>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
      var activeFilename = null;

      function loadFile(element,url) {
        // Remove "active" class from all list items
        $('#file-list li').removeClass('active');
        
        // Add "active" class to the clicked list item
        $(element).parent().addClass('active');

        // Set the active filename
        activeFilename = $(element).text();

        $.get(url, function(data) {
              $('#file-content-container').html(data);
          });

        $('#download_link').attr('href', 'output/' + activeFilename);
      }

      function download_file(){
        // Get the content of the <pre> element within the div with id 'file-content'
        var content = document.getElementById('file-content').querySelector('pre').innerText;

        // Create a Blob containing the content
        var blob = new Blob([content], { type: 'text/plain' });

        var downloadLink = document.createElement('a');
        downloadLink.href = window.URL.createObjectURL(blob);
        downloadLink.download = 'log.txt';

        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
      }

  </script>

  <title>AutoOD: Automatic Outlier Detection</title>

  </head>
  <body>
      <div class="logging_window">
        <ul id="file-list" class="grid-item">
            {% for file in files %}
                <li class="list_item">
                  <a href="#" onclick="loadFile(this, '{{ url_for('logs.view_file', filename=file) }}')">{{ file }} <!-- Ignore Error -->
                  </a>
                </li>
            {% endfor %}
        </ul>

        <div id="file-content-container" class="grid-item"></div>
      </div>
      <button id="download-btn" onclick="download_file()">Download Active File</button>
  </body>
</html> 